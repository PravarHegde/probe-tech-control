import{_ as c}from"./WebcamNozzleCrosshair-B8sRmZuR.js";import{m as u,B as p,a as g,P as h,R as _,W as l,C as f,n as d}from"./index-CWrpshtP.js";import{m as b,n as w,r as v}from"./vuetify-CGRNWlIO.js";import"./overlayscrollbars-CiKU261J.js";import"./echarts-Ce9dz-GT.js";import"./codemirror-Dbba2-Wz.js";var S=Object.defineProperty,y=Object.getOwnPropertyDescriptor,a=(n,t,e,s)=>{for(var i=s>1?void 0:s?y(t,e):t,o=n.length-1,m;o>=0;o--)(m=n[o])&&(i=(s?m(t,e,i):m(i))||i);return s&&i&&S(t,e,i),i};let r=class extends u(p,g){constructor(){super(...arguments),this.isVisibleDocument=!0,this.isVisibleViewport=!1,this.status="connecting",this.statusMessage="",this.timer=null,this.request_start_time=performance.now(),this.time=0,this.request_time=0,this.request_time_smoothing=.2,this.currentFPS=null,this.fpsTimer=null,this.frames=0,this.aspectRatio=null}get wrapperStyle(){return this.getWrapperStyle(this.aspectRatio,this.camSettings.rotation)}get webcamStyle(){var t,e,s,i;return{transform:this.generateTransform((t=this.camSettings.flip_horizontal)!=null?t:!1,(e=this.camSettings.flip_vertical)!=null?e:!1,(s=this.camSettings.rotation)!=null?s:0,(i=this.aspectRatio)!=null?i:1)}}get fpsOutput(){return this.currentFPS===null?"--":this.currentFPS<10?"0"+this.currentFPS.toString():this.currentFPS}get showFpsCounter(){var t,e;return this.showFps?!((e=(t=this.camSettings.extra_data)==null?void 0:t.hideFps)!=null&&e):!1}get url(){var t;return this.convertUrl((t=this.camSettings)==null?void 0:t.snapshot_url,this.printerUrl)}get isVisible(){return this.isVisibleDocument&&this.isVisibleViewport}get showNozzleCrosshair(){var e,s;return((s=(e=this.camSettings.extra_data)==null?void 0:e.nozzleCrosshair)!=null?s:!1)&&this.status==="connected"}mounted(){document.addEventListener("visibilitychange",this.documentVisibilityChanged)}beforeDestroy(){document.removeEventListener("visibilitychange",this.documentVisibilityChanged),this.stopStream()}documentVisibilityChanged(){const t=document.visibilityState;this.isVisibleDocument=t==="visible"}viewportVisibilityChanged(t){this.isVisibleViewport=t}isVisibleChanged(t){if(t){this.startStream();return}this.stopStream()}refreshFrame(){if(!this.isVisible)return;this.timer!==null&&(window.clearTimeout(this.timer),this.timer=null);const t=new URL(this.url);t.searchParams.append("bypassCache",new Date().getTime().toString()),this.image.src=t.toString(),this.request_start_time=performance.now()}onLoad(){this.status!=="connected"&&(this.status="connected",this.statusMessage=""),this.frames++,this.aspectRatio===null&&(this.aspectRatio=this.updateAspectRatioFromImage(this.image));const e=1e3/(this.camSettings.target_fps||10),s=performance.now()-this.request_start_time;this.request_time=this.request_time*this.request_time_smoothing+s*(1-this.request_time_smoothing);const i=Math.max(0,e-this.request_time);this.timer=window.setTimeout(this.refreshFrame,i)}onError(){this.status="error",this.statusMessage=this.$t("Panels.WebcamPanel.ErrorWhileConnecting",{url:this.url}).toString(),this.timer===null&&(this.timer=window.setTimeout(this.refreshFrame,1e3))}startStream(){this.isVisible&&(this.status!=="connected"&&(this.status="connecting",this.statusMessage=this.$t("Panels.WebcamPanel.ConnectingTo",{url:this.url}).toString()),this.clearTimers(),this.fpsTimer=window.setInterval(()=>{this.currentFPS=this.frames,this.frames=0},1e3),this.refreshFrame())}stopStream(){this.clearTimers()}clearTimers(){this.timer&&(window.clearTimeout(this.timer),this.timer=null),this.fpsTimer&&(window.clearTimeout(this.fpsTimer),this.fpsTimer=null,this.frames=0)}camSettingsChanged(){this.aspectRatio=null,this.stopStream(),this.status="connecting",this.startStream()}};a([h({required:!0})],r.prototype,"camSettings",2);a([h({default:null})],r.prototype,"printerUrl",2);a([h({default:!0})],r.prototype,"showFps",2);a([_("image")],r.prototype,"image",2);a([l("isVisible",{immediate:!0})],r.prototype,"isVisibleChanged",1);a([l("camSettings",{deep:!0})],r.prototype,"camSettingsChanged",1);r=a([f],r);var C=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{directives:[{name:"observe-visibility",rawName:"v-observe-visibility",value:t.viewportVisibilityChanged,expression:"viewportVisibilityChanged"}],staticClass:"webcamBackground",style:t.wrapperStyle},[e("img",{directives:[{name:"show",rawName:"v-show",value:t.status==="connected",expression:"status === 'connected'"}],ref:"image",staticClass:"webcamImage",style:t.webcamStyle,attrs:{draggable:"false",alt:t.camSettings.name,src:"#"},on:{error:t.onError,load:t.onLoad}}),t.status==="connected"&&t.showFpsCounter?e("span",{staticClass:"webcamFpsOutput"},[t._v(" "+t._s(t.$t("Panels.WebcamPanel.FPS"))+": "+t._s(t.fpsOutput)+" ")]):t._e(),t.showNozzleCrosshair?e(c,{attrs:{webcam:t.camSettings}}):t._e(),t.status!=="connected"?e(b,[e(w,{staticClass:"_webcam_mjpegstreamer_output text-center d-flex flex-column justify-center align-center"},[t.status==="connecting"?e(v,{staticClass:"mb-3",attrs:{indeterminate:"",color:"primary"}}):t._e(),e("span",{staticClass:"mt-3"},[t._v(t._s(t.statusMessage))])],1)],1):t._e()],1)},F=[],P=d(r,C,F,!1,null,"59ba243d");const W=P.exports;export{W as default};
